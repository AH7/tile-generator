---
name: test-tile
label: Generated Test Tile
description: A sample tile generated by tile-generator
icon_file: resources/icon.png

# Global defaults (all optional)
# org: test-org                       # Optional
# space: test-space                   # Optional
# docker_bosh_version: '28'           # Optional, default: latest release
apply_open_security_group: true       # Apply open security group, default: false
allow_paid_service_plans: true        # Allow paid service plans, default: false

properties:
- name: author
  type: string
  label: Author
  value: Tile Ninja

forms:
- name: contact_form
  label: Contact Info
  description: Examples of basic property types
  properties:
  - name: customer_name
    type: string
    label: Full Name
    optional: true
  - name: street_address
    type: string
    label: Street Address
    description: Address to use for junk mail
    optional: false
  - name: city
    type: string
    label: City
  - name: zip_code
    type: string
    label: ZIP+4
    default: '90310'
  - name: country
    type: dropdown_select
    label: Country
    options:
    - name: country_us
      label: US
      default: true
    - name: country_elsewhere
      label: Elsewhere
- name: albums_form
  label: Albums
  description: Example of collection property type
  properties:
  - name: example_collection
    type: collection
    label: Albums
    configurable: true
    property_blueprints:
    - name: album
      type: string
      label: Album
    - name: artist
      type: string
      label: Artist
    - name: explicit
      type: boolean
      label: Explicit
    default:
    - album: Christmas Carols
      artist: Ops Manatee
      explicit: true
- name: food_form
  label: Food Order
  description: Example of selector property type
  properties:
  - name: example_selector
    type: selector
    label: Food Choices
    configurable: true
    default: Pizza
    option_templates:
    - name: pizza_option
      select_value: Pizza
      property_blueprints:
      - name: pepperoni
        type: boolean
        label: Pepperoni
        configurable: true
      - name: pineapple
        label: Pineapple
        type: boolean
        configurable: true
      - name: other_toppings
        label: Other Toppings
        type: string
        configurable: true
        optional: true
    - name: filet_mignon_option
      select_value: Filet Mignon
      property_blueprints:
      - name: rarity_dropdown
        label: How rare?
        type: dropdown_select
        configurable: true
        default: rare
        options:
        - name: rare
          label: 'Rare'
        - name: medium
          label: 'Medium'
        - name: well-done
          label: 'Well done'
- name: credentials_form
  label: Credentials
  description: Examples of secret property types
  properties:
  - name: my_creds
    type: simple_credentials
    label: Simple Credentials
    description: Example of simple credentials type
  - name: username
    type: string
    label: Username
    constraints:
    - must_match_regex: '^[^!@#$%^&*()]*$'
      error_message: 'This name cannot contain capital digits.'
  - name: password
    type: secret
    label: Password

service_plan_forms:
- name: custom_dynamic_service_plan_1
  label: Custom Dynamic Service Plan 1 
  description: Custom Dynamic service plan 1 for Test Tile
  properties:
  - name: description1
    type: string
    configurable: true
    description: The description of this plan
  - name: license_key1
    type: string
    configurable: true
    description: The license key for this plan
  - name: num_seats1
    type: integer
    configurable: true
    description: The number of available seats for this license
    default: 1
    constraints:
      min: 1
      max: 500
- name: custom_dynamic_service_plan_2
  label: Custom Dynamic Service Plan 2
  description: Custom Dynamic service plan 2 for Test Tile
  properties:
  - name: description2
    type: string
    configurable: true
    description: The description of this plan
  - name: api_key2
    type: string
    configurable: true
    description: The api key for this plan
  - name: num_of_license2
    type: integer
    configurable: true
    description: The number of licenses
    default: 1

packages:

- name: app1                          # App with minimal configuration, i.e. all default values
  type: app
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G

- name: app1-auto-zip                 # app1, specified by source directory to test auto-zipping
  type: app
  manifest:
    path: src/app
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G

- name: binary-app                    # Self-contained app to test binary buildpack
  type: app
  manifest:
    path: src/binary-app/binary-app.py
    command: ./binary-app.py          # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G
    buildpack: binary_buildpack

- name: service-broker1               # Broker with minimal configuration, i.e. all default values
  type: app-broker
  enable_global_access_to_plans: true
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G

- name: app2                          # App showing configurable values
  type: app
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    host: app2-hostname               # Override hostname, default: app name
    memory: 256M                      # Override memory, default: 1G
  health_check: none                  # Turn off health monitoring, default: true
  auto_services:                      # Auto-provision and bind services
  - name: service-broker1-service     # If using a broker in the same tile, the broker must preceed the app in this file
    plan: first-plan                  # Optionally specify a plan (default is the first plan offered by the service)
  needs_cf_credentials: true          # Pass CF creds to the app, default: false

- name: service-broker2               # Broker showing additional configurable values
  type: app-broker
  manifest:
    path: resources/app.zip
    command: python app.py            # This is required for python, optional for many other languages
    memory: 256M                      # Override memory, default: 1G
  internal_service_names:
  - service1
  - service2

- name: noop-buildpack                # A buildpack
  type: buildpack
  buildpack_order: 99                 # 99 (or higher) means go to the end of the list
  path: resources/buildpack.zip

- name: noop-decorator                # A decorator buildpack
  type: decorator
  path: resources/decorator.zip

- name: app3
  type: docker-app
  image: guidowb/sample-cf-app        # Start command must be specified in the Dockerfile (CMD)
  manifest:
    memory: 256M                      # Override memory, default: 1G
  auto_services:                      # Auto-provision and bind services
  - name: service-broker1-service     # If using a broker in the same tile, the broker must preceed the app in this file
    plan: second-plan                 # Optionally specify a plan (default is the first plan offered by the service)

- name: app4
  type: docker-bosh
  docker_images:
  - guidowb/sample-cf-app
  cpu: 2
  memory: 512
  ephemeral_disk: 4096
  persistent_disk: 2048
  instances: 1
  manifest: |
    containers:
    - name: app
      image: "guidowb/sample-cf-app" # should match the docker image name
      bind_ports:
      - '80:80'
      - '443:443'
      - '8080:8080'
      - '8443:8443'

- name: app5
  type: bosh-release
  path: resources/redis-12+dev.1.tgz
  jobs:
  - name: redis_leader_z1
    templates:
    - name: redis
      release: redis
    memory: 512
    ephemeral_disk: 4096
    persistent_disk: 4096
    cpu: 2
    static_ip: 1
    max_in_flight: 1
    properties:
      network: redis1
      redis:
        password: red!s
  - name: redis_z1
    templates:
    - name: redis
      release: redis
    instances: 2
    memory: 512
    ephemeral_disk: 4096
    persistent_disk: 4096
    cpu: 2
    static_ip: 1
    properties:
      network: redis1
      redis:
        master: (( .redis_leader_z1.first_ip ))
        password: red!s
  - name: redis_test_slave_z1
    templates:
    - name: redis
      release: redis
    instances: 1
    memory: 512
    ephemeral_disk: 4096
    persistent_disk: 4096
    cpu: 2
    static_ip: 1
    properties:
      network: redis1
      redis:
        master: (( .redis_leader_z1.first_ip ))
        password: red!s
  - name: acceptance-tests
    templates:
    - name: acceptance-tests
      release: redis
    lifecycle: errand
    post_deploy: true
    memory: 512
    ephemeral_disk: 4096
    persistent_disk: 0
    cpu: 2
    dynamic_ip: 1
    properties:
      redis:
        master: (( .redis_leader_z1.first_ip ))
        password: red!s
        slave: (( .redis_test_slave_z1.first_ip ))
